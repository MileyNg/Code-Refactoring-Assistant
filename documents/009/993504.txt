/*
Hokudai Practice Contest 2014
D - Cheese

ティツァツ」テヲツウツ陛ッツシツ咤FS
テ」ツδ?」ツδシテ」ツつコテ」ツつ?テ」ツ?、テゥツ」ツ淌」ツ?ケテァツオツづ」ツつ湘」ツ?」テ」ツ?ヲテ」ツ?凝」ツつ嘉ヲツャツ。テ」ツ?ォテ・ツ青妥」ツ?凝」ツ??」ツδ?」ツδシテ」ツつコテ」ツ?ョテ、ツスツ催ァツスツョテ」ツ?古・ツョツ堙」ツつ?」ツつ嘉」ツつ古」ツ?ヲテ」ツ??」ツつ凝」ツ?ョテ」ツ?ァテ」ツ??
(S -> 1テ」ツ?ョテヲツ慊?ァツ淞ュティツキツッ) + (1 -> 2テ」ツ?ョテヲツ慊?ァツ淞ュティツキツッ) + ... + (N-1 -> Nテ」ツ?ョテヲツ慊?ァツ淞ュティツキツッ)テ」ツつ津ヲツアツづ」ツつ?」ツつ古」ツ?ーティツ可ッテ」ツ??」ツ??
テヲツ慊?ァツ淞ュティツキツッテ」ツ?ョティツィツ暗ァツョツ療」ツ?ォテ」ツ?ッBFS(テ・ツケツ?・ツ?ェテ・ツ?暗ヲツ篠「テァツエツ「)テ」ツつ津ァツ板ィテ」ツ??」ツつ凝」ツ?禿」ツ?ィテ」ツ?古」ツ?ァテ」ツ?催」ツつ凝」ツ??

BFSテ、ツクツ?・ツ崢榲」ツ?ョテヲツ卍づゥツ鳴禿ィツィツ暗ァツョツ療ゥツ?湘」ツ?薫(HW)テ」ツ?ァテ」ツ??」ツ?禿」ツつ古」ツつ誰テ・ツ崢榲ィツ。ツ古」ツ??」ツ?ョテ」ツ?ァテ」ツ??・ツ?ィテ、ツスツ禿」ツ?ァO(NHW)テ」ツ?ィテ」ツ?ェテ」ツつ凝」ツ??
*/

#include<iostream>
#include<queue>
#include<algorithm>
using namespace std;

//テゥツ堋」テヲツ篠・4テヲツ鳴ケテ・ツ青妥」ツつ津・ツョツ堙ァツセツゥ
const int dy[] = {-1,0,1,0}, dx[] = {0,1,0,-1};
const int INF = 1e8;

int main(){
  int h,w,n;
  int x[10],y[10];
  string grid[1000];
  cin >> h >> w >> n;

  for(int i=0;i<h;i++)cin >> grid[i];

  //テ」ツδ?」ツδシテ」ツつコiテ」ツ?ョテ・ツ?エテヲツ可?」ツつ遅[i],y[i]テ」ツ?ォティツィツ佚ゥツ個イ
  for(int i=0;i<h;i++){
    for(int j=0;j<w;j++){
      if(grid[i][j] == 'S'){
	y[0] = i; x[0] = j;
      }
      if(grid[i][j] != 'X' && grid[i][j] != '.'){
	y[grid[i][j] - '0'] = i; x[grid[i][j] - '0'] = j;
      }
    }
  }

  int ans = 0;
  //nテ・ツ崢曖FSテ」ツつ津ィツ。ツ古」ツ??
  for(int i=0;i<n;i++){
    int dis[1000][1000];
    queue<int> qx,qy;

    //テ・ツ按敕ヲツ慊淌・ツ個?
    for(int k=0;k<h;k++){
      for(int j=0;j<w;j++){
	dis[k][j] = INF;
      }
    }
    dis[y[i]][x[i]] = 0;

    qy.push(y[i]); qx.push(x[i]);

    //BFS
    while(!qx.empty()){
      //テァツ渉セテ・ツ慊ィテ」ツ?ョテ、ツスツ催ァツスツョ
      int cy = qy.front(), cx = qx.front();
      qy.pop(); qx.pop();

      //テゥツ堋」テヲツ篠・4テヲツ鳴ケテ・ツ青妥」ツつ津ヲツ篠「テァツエツ「テ」ツ?凖」ツつ?
      for(int d=0;d<4;d++){
	int ny = cy + dy[d], nx = cx + dx[d];
	//テァツ崢、テ・ツ、ツ姪・ツ按、テ・ツョツ?
	if(ny<0 || nx<0 || ny>=h || nx>=w)continue;
	//テゥツ堋愿・ツョツウテァツ可ゥテ・ツ按、テ・ツョツ?
	if(grid[ny][nx] == 'X')continue;

	//dis == INFテ」ツ?ェテ」ツつ嘉」ツ??」ツ?セテ」ツ??ィツィツェテ」ツつ古」ツ?ヲテ」ツ??」ツ?ェテ」ツ??
	if(dis[ny][nx] == INF){
	  dis[ny][nx] = dis[cy][cx] + 1;
	  qy.push(ny); qx.push(nx);
	}
      }
    }

    ans += dis[y[i+1]][x[i+1]];
  }

  cout << ans << endl;
}